# 索引

[toc]



## 索引概念

索引是帮助MySQL高效获取数据的排好序的数据结构

### 索引结构

高度小,查找快

#### 二叉树

#### 红黑树

#### Hash表

对索引的key进行一次hash计算就可以定位出数据存储的位置

很多时候Hash索引要比B+树索引更高效

仅能满足"=","IN",不支持范围查询

hash冲突问题

#### B-Tree

1. 页节点具有相同的深度,叶节点的指针为空

2. 所有索引不重复

3. 节点中的数据索引从左到右递增排列

B-Tree , B+Tree(多叉平衡树)

* B+Tree
    * 非叶子几点不存储data,只存储索引(冗余),可以放更多的索引
    * 叶子节点包含所有的索引字段
    * 叶子节点用指针连接,提高区间访问的性能
    
    
    
    ```sql
    -- 查询mysql一页数据的大小
    SHOW GLOBAL STATUS LIKE 'Innodb_page_size'
    
    Variable_name	Value
    Innodb_page_size	16384
    ```
    
    ![image-20210221213232081](https://raw.githubusercontent.com/w15997402070/images/main/note/image-20210221213232081.png)
    
    假设索引字段用bigint 8字节,加上子节点的地址6字节,第一层可以放16kb/8byte+6byte≈1170
    
    第二层每个节点同样的也是1170,
    
    假设高度3的时候,叶子节点每个数据为1kb,可以存16条数据,
    
    三层计算下来`1170*1170*16=21902400`大概2000多万条数据
    
    
    
    主键索引
    
    InnoDB 引擎的数据存储在叶子节点
    
    ![image-20210221214855944](https://raw.githubusercontent.com/w15997402070/images/main/note/image-20210221214855944.png)
    
    MyISAM引擎的数据存储在单独文件中,索引叶子节点存储数据存放的地址,通过索引找到地址后再按照地址找数据
    
    ![image-20210221214920636](https://raw.githubusercontent.com/w15997402070/images/main/note/image-20210221214920636.png)
    
* 

###  索引类型

#### 聚集索引

页节点包含了完整的数据记录(InnoDB引擎)

#### 非聚集索引

叶子节点不包含完整数据(MyISAM引擎)



#### 主键索引

#### 联合索引

联合索引存储结构

![image-20210222210644026](https://raw.githubusercontent.com/w15997402070/images/main/note/image-20210222210644026.png)

最左前缀原则



1. 为什么建议InnoDB表必须建主键,并且推荐使用整形的自增主键?

如果自己不建主键索引,MySQL会自己查找一列数据都不相同的建默认的主键索引,如果还找不到就会建一个类似rowid的唯一的隐藏列,这会消耗MySQL的资源的,所以最好自己建主键索引

2. 为什么非主键索引结构叶子节点存储的是主键值?(一致性和节省存储空间)

## 高性能的索引策略

* 独立的列

  指索引不能是表达式的一部分,也不能是函数的参数

  ```sql
  SELECT id,`name` FROM test WHERE id+1 = 2
  ```

  **所以应该始终将索引列单独放在比较符号的一侧**

* 前缀索引

* 合适的索引列顺序

## 

